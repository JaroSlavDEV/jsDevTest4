document.addEventListener("DOMContentLoaded",function(){var e=[].slice.call(document.querySelectorAll("img.lazy")),t=[].slice.call(document.querySelectorAll(".lazy-background")),r=[].slice.call(document.querySelectorAll("[data-bg]"));if("IntersectionObserver"in window){let d=new IntersectionObserver(function(e,t){e.forEach(function(e){if(e.isIntersecting){let t=e.target;t.src=t.dataset.src,t.srcset=t.dataset.srcset,t.classList.remove("lazy"),d.unobserve(t)}})});e.forEach(function(e){d.observe(e)});let o=new IntersectionObserver(function(e,t){e.forEach(function(e){e.isIntersecting&&(e.target.classList.add("visible"),o.unobserve(e.target))})});t.forEach(function(e){o.observe(e)});let c=new IntersectionObserver(function(e,t){e.forEach(function(e){if(e.isIntersecting){let t=e.target;t.style.backgroundImage="url("+t.dataset.bg+")",c.unobserve(t)}})});r.forEach(function(e){c.observe(e)})}else e.forEach(function(e){e.src=e.dataset.src,e.srcset=e.dataset.srcset}),t.forEach(function(e){e.classList.add("visible")}),r.forEach(function(e){e.style.backgroundImage="url("+e.dataset.bg+")"})});const buttonsCreateRecord=document.querySelectorAll(".create_record"),buttonsSaveRecord=document.querySelectorAll(".save_record"),buttonsDeleteFewRecords=document.querySelectorAll(".delete_few_records"),bodyRecords=document.querySelectorAll(".records");let idOfficeRecordToEdit=null,idStaffRecordToEdit=null;const officeArray=[],staffArray=[];function formRecordValidation(e){const t=document.getElementById("office_name").value,r=document.getElementById("staff_name").value,d=document.getElementById("staff_office_name").value,o="offices"===e?{name:t}:"staff"===e?{name:r,staffOfficeName:d}:{};for(let t in o)if(""===o[t])return alert(`Fill in all the field of "${e}" form`),0;return o}function createRecord(e){e.preventDefault();const t=e.target.getAttribute("data-form");let r=formRecordValidation(t);if(!r)return 0;const{name:d,staffOfficeName:o}=r;createRecordHTML(t,Date.now(),d,o)}function createRecordHTML(e,t,r,d){const o=(new Date).toLocaleDateString(),c=document.querySelector(`.records[data-form='${e}']`),a=document.createElement("tr"),n=document.createAttribute(`data-${e}-record-id`),i=document.createAttribute(`data-${e}-record-name`),f=document.createAttribute(`data-${e}-record-checked`);a.classList=`${e}-record`,a.id=`${e}-record-`+t,n.value=t,i.value=r,f.value=!1,a.setAttributeNode(n),a.setAttributeNode(i),a.setAttributeNode(f);const l=document.createElement("td");l.innerHTML=r;const s=document.createAttribute("data-form");s.value=e;const u=document.createElement("td"),m=document.createElement("button");m.classList="edit_record far fa-edit",m.setAttributeNode(s),u.append(m);const y=document.createAttribute("data-form");y.value=e;const b=document.createElement("td"),E=document.createElement("button");if(E.classList="delete_record far fa-trash-alt",E.setAttributeNode(y),b.append(E),"offices"===e){if(officeArray.some(e=>e.name===r))return alert("Entered office already exist !"),0;c.append(a),a.append(l),a.append(u),a.append(b),document.getElementById("office_name").value="",officeArray.push({id:t,name:r})}else if("staff"===e){if(!officeArray.some(e=>e.name===d))return alert("Entered office does't exist !"),0;const n=document.createAttribute(`data-${e}-record-office-name`);n.value=d,a.setAttributeNode(n);const i=document.createElement("td");i.innerHTML=d,a.append(i);const f=document.createElement("td");f.innerHTML=o,a.append(f),c.append(a),a.append(l),a.append(i),a.append(f),a.append(u),a.append(b),document.getElementById("staff_name").value="",document.getElementById("staff_office_name").value="",staffArray.push({id:t,name:r,staffOfficeName:d})}}function editRecord(e,t){if("offices"===t&&idOfficeRecordToEdit){const e=document.querySelector(`.${t}-record[data-${t}-record-id="${idOfficeRecordToEdit}"]`);e.querySelector(".edit_record").disabled=!1,e.querySelector(".delete_record").disabled=!1,idOfficeRecordToEdit=null}else if("staff"===t&&idStaffRecordToEdit){const e=document.querySelector(`.${t}-record[data-${t}-record-id="${idStaffRecordToEdit}"]`);e.querySelector(".edit_record").disabled=!1,e.querySelector(".delete_record").disabled=!1,idStaffRecordToEdit=null}const r=document.querySelector(`.${t}-record[data-${t}-record-id="${e}"]`);"offices"===t?(idOfficeRecordToEdit=e,document.getElementById("office_name").value=r.getAttribute(`data-${t}-record-name`)):"staff"===t&&(idStaffRecordToEdit=e,document.getElementById("staff_name").value=r.getAttribute(`data-${t}-record-name`),document.getElementById("staff_office_name").value=r.getAttribute(`data-${t}-record-office-name`)),document.querySelector(`.create_record[data-form="${t}"]`).disabled=!0,document.querySelector(`.save_record[data-form="${t}"]`).disabled=!1,document.querySelector(`.delete_few_records[data-form="${t}"]`).disabled=!0,r.querySelector(".edit_record").disabled=!0,r.querySelector(".delete_record").disabled=!0}function saveRecord(e){e.preventDefault();const t=e.target.getAttribute("data-form");if("offices"===t&&null===idOfficeRecordToEdit||"staff"===t&&null===idStaffRecordToEdit)return 0;let r=formRecordValidation(t);if(!r)return 0;const{name:d,staffOfficeName:o}=r;if("offices"===t){if(officeArray.some(e=>e.name===d))return alert("Entered office already exist !"),0;const e=document.querySelector(`.${t}-record[data-${t}-record-id="${idOfficeRecordToEdit}"]`);e.setAttribute(`data-${t}-record-name`,d),e.querySelector("td:nth-child(1)").innerHTML=d,idOfficeRecordToEdit=null,e.querySelector(".edit_record").disabled=!1,e.querySelector(".delete_record").disabled=!1,document.getElementById("office_name").value=""}else if("staff"===t){if(!officeArray.some(e=>e.name===o))return alert("Entered office does't exist !"),0;const e=document.querySelector(`.${t}-record[data-${t}-record-id="${idStaffRecordToEdit}"]`);e.setAttribute(`data-${t}-record-name`,d),e.setAttribute(`data-${t}-record-office-name`,o),e.querySelector("td:nth-child(1)").innerHTML=d,e.querySelector("td:nth-child(2)").innerHTML=o,idStaffRecordToEdit=null,e.querySelector(".edit_record").disabled=!1,e.querySelector(".delete_record").disabled=!1,document.getElementById("staff_name").value="",document.getElementById("staff_office_name").value=""}document.querySelector(`.create_record[data-form="${t}"]`).disabled=!1,document.querySelector(`.save_record[data-form="${t}"]`).disabled=!0,document.querySelector(`.delete_few_records[data-form="${t}"]`).disabled=!1}function deleteRecord(e,t,r){if(!r){if(!window.confirm("Do you really want to delete this record ?"))return 0}const d=document.querySelector(`.${t}-record[data-${t}-record-id="${e}"]`);if("offices"===t){const e=d.getAttribute(`data-${t}-record-name`);staffArray.filter(t=>t.staffOfficeName===e).forEach(e=>deleteRecord(e.id,"staff",!0))}d.remove()}function deleteFewRecords(e){if(e.preventDefault(),!window.confirm("Do you really want to delete these records ?"))return 0;const t=e.target.getAttribute("data-form");document.querySelectorAll(`.${t}-record[data-${t}-record-checked="true"`).forEach(e=>deleteRecord(e.getAttribute(`data-${t}-record-id`),t,!0))}function delegationEditDelete(e){if(e.target.className.split(" ").includes("edit_record")){const t=e.target.getAttribute("data-form");editRecord(e.target.parentNode.parentNode.getAttribute(`data-${t}-record-id`),t)}else if(e.target.className.split(" ").includes("delete_record")){const t=e.target.getAttribute("data-form");deleteRecord(e.target.parentNode.parentNode.getAttribute(`data-${t}-record-id`),t)}else{const t=e.target.parentNode.parentNode.getAttribute("data-form"),r=e.target.parentNode.getAttribute(`data-${t}-record-id`),d="true"===document.querySelector(`.${t}-record[data-${t}-record-id="${r}"]`).getAttribute(`data-${t}-record-checked`);document.querySelector(`.${t}-record[data-${t}-record-id="${r}"]`).setAttribute(`data-${t}-record-checked`,!d)}}async function getOffices(){const e=await fetch("http://dev.smartpelican.com/public/test_task/departments.php");(await e.json()).forEach(e=>createRecordHTML("offices",e.id,e.name))}document.addEventListener("DOMContentLoaded",function(){Array.prototype.forEach.call(buttonsCreateRecord,e=>e.addEventListener("click",createRecord)),Array.prototype.forEach.call(buttonsSaveRecord,e=>e.addEventListener("click",saveRecord)),Array.prototype.forEach.call(buttonsDeleteFewRecords,e=>e.addEventListener("click",deleteFewRecords)),Array.prototype.forEach.call(bodyRecords,e=>e.addEventListener("click",delegationEditDelete)),getOffices()});